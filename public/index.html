<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ChallengeFinder</title>
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <script type="text/x-handlebars">
    <h2>ChallengeFinder</h2>

    {{outlet}}
  </script>

  <script type="text/x-handlebars" id="index">
    {{#each challenge in model}}
      <div class="row-2">
          <div class="span2">
            <img {{bind-attr src=challenge.image_url}} width="100px" height="100px"/>
          </div>
          <div class="span4">
            <h5>{{#link-to 'challenge' challenge}}{{challenge.title}}{{/link-to}}</h5>
            <p>{{challenge.tag_line}}</p>
            <p>Sponsor: {{challenge.sponsor}}</p>
            {{#link-to 'challenge' challenge}}Learn More{{/link-to}}
          </div>
          <div class="span3">
          {{#each award in challenge.awards}}
            <p><strong>AWARD &nbsp; </strong>Variable (See Details)</p>
            <p><span class="dividing-line">-------------</span></p>
          {{/each}}
          {{#each award in challenge.awards}}
            <p><strong>DEADLINE &nbsp; </strong>{{challenge.index_deadline}}</p>
            <p><span class="dividing-line">--------------</span></p>
          {{/each}}
            <p><strong>POSTED &nbsp; </strong>{{challenge.post_date}}</p>
          </div>
          <p class="dot-divider">.....................................................<p>
      </div>
    {{/each}}
  </script>
  
  <script type="text/x-handlebars" id="challenge">
    <h1 class="page-header">// CHALLENGES</h1>
  
    <div class="span8">
  
      <div class="row-2">
        <div class="span2">
              <img src="images/{{unbound challenge.image_topic}}.jpg" width="100px" height="100px"/>
            </div>
        <div class="span6">

          <h5>{{challenge.title}}</h5>        

                <p>{{challenge.tag_line}}</p>

                <p>Sponsor: &nbsp;{{challenge.sponsor}}</p>

              <p>Status: &nbsp;{{challenge.status}}</p>

              <br>
                <div class="detail-highlights"><p>AWARD &nbsp;
                {{#each award in challenge.awards}}
            <%= @challenge.awards.max { |a, b| a.value.length == b.value.length ? a.value <=> b.value : a.value.length <=> b.value.length }.value if @challenge.awards %>
            </p>
                </div>
              
          <div class="detail-highlights"><p>DEADLINE &nbsp;
                  <%= "See Details Below" if @challenge.deadlines[0].description.length > 10 && @challenge.deadlines[0].date == nil %>
                  <%= "None" if @challenge.deadlines[0].description.length < 10 && @challenge.deadlines[0].date == nil || @challenge.deadlines.count == 0 %>
                  <%= dt = @challenge.deadlines.map {|deadline| deadline.date}.min() if @challenge.deadlines;
                   dt.strftime('%b %e, %Y') if dt %>
            </p>
                </div>

          <div class="detail-highlights"><p id="challenge-url">WEBSITE 
              <%= link_to 'Challenge Website', @challenge.url, :target => "_blank" %>
            </p><br>
          </div>
      
          <div class="detail-highlights"><p>SUMMARY</p></div>
          <p>
            <%=raw @challenge.summary.gsub(/\n/, '<br>').html_safe %>
          </p>
          <br>
         <!--  <p>
            <b>Image url:</b>
          <%= @challenge.image_url %>
          </p> -->
          <div class="detail-highlights"><p>RULES</p></div>
          <p><%=raw @challenge.rules.gsub(/\n/, '<br>').html_safe %>
          </p>
      
          <div class="detail-highlights"><p></p></div>
          <p><%=raw @challenge.eligibility.gsub(/\n/, '<br>').html_safe %>
          </p>
      
          <div class="detail-highlights"><p></p></div>
          <p><%=raw @challenge.fee.gsub(/\n/, '<br>').html_safe %>
          </p><br>

          <div class="detail-highlights"><p>AWARD</p></div>
          <p><%= render :partial => "challenges/awards", :object => @challenge.awards %>
          </p><br>

          <div class="detail-highlights"><p>DEADLINE</p></div>
          <p><%= render :partial => "challenges/deadlines", :object => @challenge.deadlines %>
          </p><br>

          <div class="detail-highlights"><p>POST DATE</p></div>
          <p><%= @challenge.post_date.strftime('%b %e, %Y') if @challenge.post_date %>
          </p><br>      

          <div class="detail-highlights"><p>CONTACT INFORMATION</p></div>
          <p><%=raw @challenge.contact_info.gsub(/\n/, '<br>').html_safe %>
          </p><br>
      

          <div class="detail-highlights"><p>SHARE</p></div>
            <span class="fb-share-button">
              <a href="#" 
                onclick="
                window.open(
                  'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent('<%= @challenge.url %>'), 
                  'facebook-share-dialog', 
                  'width=626,height=436'); 
                return false;">
                Facebook &nbsp;
              </a>
            </span>
            <a href="https://twitter.com/share" class="twitter-share-button" data-url="<%= @challenge.url %>" data-text="<%= @challenge.title %> @ChallengeFinder" data-count="none">Tweet</a>
                <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
      
      
        </div>

      
      </div>
    
    </div>
  </script>

  <script src="js/libs/jquery-1.11.0.min.js"></script>
  <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  <script src="js/libs/handlebars-1.1.2.js"></script>
  <script src="js/libs/ember-1.4.0.js"></script>
  <script src="js/libs/ember-model-latest.js"></script>
  <script src="js/app.js"></script>
  <!-- to activate the test runner, add the "?test" query string parameter -->
  <script src="tests/runner.js"></script>
</body>
</html>
